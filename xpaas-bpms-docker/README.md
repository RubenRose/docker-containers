JBoss BPMS Docker Image
=======================

This project builds a [docker](http://docker.io/) container for running JBoss BPMS.

This image provides a container including:     
* XPaaS JBoss Wildfly / JBoss EAP docker image
* JBoss BPMS 6.1.0.CR1

Before running this container it's recommended to read the documentation about JBoss Wildfly / EAP docker container.     
It can be found at this [location](../xpaas-jboss-appserver-docker/README.md)     

Table of contents
------------------

* **[Control scripts](#control-scripts)**
* **[Building the docker container](#building-the-docker-container)**
* **[Running the container](#running-the-container)**
* **[Using JBoss BPMS](#using-JBoss-BPMS)**
* **[Logging](#logging)**
* **[Stopping the container](#stopping-the-container)**

Control scripts
---------------

There are three control scripts:    
* <code>build.sh</code> Builds the JBoss BPMS docker image    
* <code>start.sh</code> Starts a new XPaaS JBoss BPMS docker image container    
* <code>stop.sh</code>  Stops the runned XPaaS JBoss BPMS docker image container    

Building the docker container
-----------------------------

Once you have [installed docker](https://www.docker.io/gettingstarted/#h_installation) you should be able to create the containers via the following:

If you are on OS X then see [How to use Docker on OS X](DockerOnOSX.md).

First, clone the repository:
    
    git clone git@github.com:pzapataf/xpaas-docker-containers.git
    cd xpaas-docker-containers/xpaas-bpms-docker
    
**Creating the JBoss BPMS for Wildly container**
    
    ./build.sh bpms-wildfly

**Creating the JBoss BPMS for EAP container**
    
    ./build.sh bpms-eap

Running the container
---------------------

To run a new image container from XPaaS JBoss Wildfly/EAP  run:
    
    ./start.sh [-i [bpms-wildfly,bpms-eap]] [-c <container_name>] [-p <root_password>] [-ap <admin_password>]
    Example: ./start.sh -i bpms-wildfly -c xpaas_bpms-wildfly -p "root123!" -ap "root123!"

Or you can try it out via docker command directly:

    docker run -P -d [--name <container_name>] [-e ROOT_PASSWORD="<root_password>"]  [-e JBOSS_APPSERVER_ADMIN_PASSWORD="<jboss_admin_password>"] xpaas/xpaas_bpms-wildfly:<version>
    docker run -P -d [--name <container_name>] [-e ROOT_PASSWORD="<root_password>"]  [-e JBOSS_APPSERVER_ADMIN_PASSWORD="<jboss_admin_password>"] xpaas/xpaas_bpms-eap:<version>

These commands will start JBoss BPMS web application.

**Notes**           
* If no container name argument is set and image to build is <code>bpms-wildfly</code>, it defaults to <code>xpaas_bpms-wildfly</code>        
* If no container name argument is set and image to build is <code>bpms-eap</code>, it defaults to <code>xpaas_bpms-eap</code>    
* If no root password argument is set, it defaults to <code>xpaas</code>    
* If no JBoss Wildfly/EAP admin user password argument is set, it defaults to <code>admin123!</code>     

Using JBoss BPMS
----------------
By default, the JBoss Wildfly/EAP HTTP interface bind address points to <code>0.0.0.0</code>, so you can discover your container port mapping for port <code>8080</code> 
and type in you browser:
 
    http://localhost:<binding_port>/kie-wb-wildfly
    http://localhost:<binding_port>/kie-wb-eap_6_1
    
Where <code>&lt;binding_port&gt;</code> can be found by running:

    docker ps -a
    
Another option if about accessing the Wildfly HTTP interface using the container IP address to, that can be found by running:

    docker inspect --format '{{ .NetworkSettings.IPAddress }}' <container_id>
    
Then you can type this URL:

    http://<container_ip_address>:8080/kie-wb-wildfly
    http://<container_ip_address>:8080/kie-wb-eap_6_1

**Notes**           
* The context name for JBoss BPMS for EAP is <code>kie-wb-eap_6_1</code>      
* The context name for JBoss BPMS for Wildfly is <code>kie-wb-wildfly</code>      
* The default <code>admin</code> password is <code>admin</code>           

Logging
-------

You can see all logs generated by supervisor daemon & programs by running:

    docker logs <container_id>
    
You can see only JBoss BPMS logs by running this command:

    ssh root@localhost -p <ssh_port> tail -f /var/log/supervisord/jboss-appserver-stdout.log
    ssh root@localhost -p <ssh_port> tail -f /var/log/supervisord/jboss-appserver-stderr.log

Stopping the container
----------------------

To stop the previous image container run using <code>start.sh</code> script just type:

    ./stop.sh

Using external MySQL database
-----------------------------

* [MySQL docker container](https://registry.hub.docker.com/_/mysql/)